/* REXX */
/***********************************************************************/
/*                                                                     */
/* <copyright                                                          */
/*     notice="cics-rm-source"                                         */
/*     pids="5655-CI1"                                                 */
/*     years="2017"                                                    */
/*     crc="3316400273" >                                              */
/*                                                                     */
/*                                                                     */
/*     Licensed Materials - Property of IBM                            */
/*                                                                     */
/*     "Restricted Materials of IBM"                                   */
/*                                                                     */
/*     5655-CI1                                                        */
/*                                                                     */
/*     (C) Copyright IBM Corp. 2017                                    */
/*                                                                     */
/*     @{[**]copyright.years=2017}}                                     */
/*                                                                     */
/*                                                                     */
/*     </copyright>                                                    */
/*                                                                     */
/***********************************************************************/
/***********************************************************************/
/*                                                                     */
/* PLEASE READ                                                         */
/*                                                                     */
/* This script contains example security profiles for dynamically      */
/* configuring security as part of the deletion of a z/OS Connect.     */
/* server.                                                             */
/*                                                                     */
/* By default this script does nothing, as there is an 'exit 0'        */
/* statement directly under this comment.  Review the profiles being   */
/* deleted and remove the 'exit 0' if you wish to use this script.     */
/*                                                                     */
/***********************************************************************/

exit 0

/***********************************************************************/
/* Delete the STARTED task for this server                             */
/***********************************************************************/
Say "Deleting STARTED task for the server"
"RDELETE STARTED {{softwareServiceInstanceName}}.*"

/***********************************************************************/
/* Delete the APPL class profile                                       */
/***********************************************************************/
Say "Deleting the server specific APPL from RACF"
"RDELETE APPL {{softwareServiceInstanceName}}"

/***********************************************************************/
/* Delete the security domain for server auth                          */
/***********************************************************************/
Say "Delete the security domain for the server"
"RDELETE SERVER BBG.SECPFX.{{softwareServiceInstanceName}}"

/***********************************************************************/
/* Delete the servers access to the angel process                      */
/***********************************************************************/
Say "Removing the servers access to the angel process"
"PERMIT bbg.angel CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

/***********************************************************************/
/* Remove the servers access to use the z/OS Authorized services       */
/***********************************************************************/

Say "Removing the server ids READ access to the authorized module BBGZSAFM"
"PERMIT bbg.authmod.bbgzsafm CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

Say "Removing the server ids READ access to the SAF authorized user registry services and SAF authorization services"
"PERMIT bbg.authmod.bbgzsafm.safcred CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

Say "Removing the server ids READ access to the SVCDUMP services"
"PERMIT bbg.authmod.bbgzsafm.zosdump CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

Say "Removing the server ids READ access to the optimized local adapter authorized service"
"PERMIT bbg.authmod.bbgzsafm.localcom CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"
"PERMIT bbg.authmod.bbgzsafm.wola CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

Say "Removing the server ids READ access to the authorized module BBGZSCFM"
"PERMIT bbg.authmod.bbgzscfm CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

Say "Removing the server ids READ access to the optimized local adapter authorized client service"
"PERMIT bbg.authmod.bbgzscfm.wola CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

Say "Removing the server ids READ access to the WLM services"
"PERMIT bbg.authmod.bbgzsafm.zoswlm CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

Say "Removing the server ids READ access to the TXRRS services"
"PERMIT bbg.authmod.bbgzsafm.txrrs CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

Say "Removing the server ids READ access to the IFAUSAGE services (PRODMGR)"
"PERMIT bbg.authmod.bbgzsafm.prodmgr CLASS(SERVER) DELETE ID({{ZCON_ADMIN_SERVER}})"

/***********************************************************************/
/* Deleting the user authorization to access the z/OS Connect          */
/* application                                                         */
/***********************************************************************/

Say "Removing the provisioning userid from the z/OS Connect access role class"
"PERMIT BBGZDFLT.zos.connect.access.roles.zosConnectAccess CLASS(EJBROLE) ID({{workflowOwner}}) DELETE"

/* Refresh */
"SETROPTS RACLIST(APPL) REFRESH"
"SETROPTS RACLIST(EJBROLE) REFRESH"
"SETROPTS RACLIST(SERVER) GENERIC(SERVER) REFRESH"
"SETROPTS RACLIST(STARTED) REFRESH"
exit