            #Remove temporary file from persistPassedValidation step
                rm {{TEMP_DIR}}/{{softwareServiceInstanceName}}.properties
                
			    export WLP_USER_DIR="{{ZCON_ZFS_MOUNTPOINT}}/{{softwareServiceInstanceName}}"
			    export JAVA_HOME="{{JAVA_HOME}}"
				
                # Get the server version
                # version="$({{ZCON_INSTALL_DIR}}/bin/zosconnect version)"
                version=$(iconv -f ISO8859-1 -t IBM-1047 {{ZCON_INSTALL_DIR}}/runtime/lib/versions/zosconnect.version.properties|grep productVersion)
                if [ $? -gt 0 ]; then 
                    echo "ERROR: Could not get the version of the z/OS Connect install" >&2;
                    exit "9"; 
                fi
                echo "$version"
                if [[ $version == *"productVersion=03"* ]]; then
                    echo "z/OS Connect is at v3"
                    echo "ZCON_SERVER_VERSION 3" > {{ZCON_ZFS_MOUNTPOINT}}/{{softwareServiceInstanceName}}/.tmp_server/server_dir
                else
	                if [[ $version == *"productVersion=02"* ]]; then
	                    echo "z/OS Connect is at v2"
	                    echo "ZCON_SERVER_VERSION 2" > {{ZCON_ZFS_MOUNTPOINT}}/{{softwareServiceInstanceName}}/.tmp_server/server_dir
	                else
	                    echo "z/OS Connect is at an unsupported version.  Only v2 and v3 are supported."
	                    exit "10";
	                fi
                fi
                
				# Create the server
				{{ZCON_INSTALL_DIR}}/bin/zosconnect create {{softwareServiceInstanceName}} --template=zosconnect:default 
				if [ $? -gt 0 ]; then 
                    echo "ERROR: Could not create z/OS Connect server" >&2;
                    exit "1"; 
                fi
				
				if [ ! -d "{{ ZCEE_CONFIG_PATH }}/resources" ]; then
				    mkdir {{ ZCEE_CONFIG_PATH }}/resources
                    if [ $? -gt 0 ]; then 
                        echo "ERROR: Could not create directory" >&2;
                        exit "2"; 
                    fi
			    fi
				if [ ! -d "{{ ZCEE_CONFIG_PATH }}/resources/zosconnect" ]; then
    			    mkdir {{ ZCEE_CONFIG_PATH }}/resources/zosconnect
                    if [ $? -gt 0 ]; then 
                        echo "ERROR: Could not create directory" >&2;
                        exit "3"; 
                    fi
			    fi
				if [ ! -d "{{ ZCEE_CONFIG_PATH }}/resources/zosconnect/apis" ]; then
				    mkdir {{ ZCEE_CONFIG_PATH }}/resources/zosconnect/apis
                    if [ $? -gt 0 ]; then 
                        echo "ERROR: Could not create directory" >&2;
                        exit "4"; 
                    fi
			    fi
				if [ ! -d "{{ ZCEE_CONFIG_PATH }}/resources/zosconnect/services" ]; then
				    mkdir {{ ZCEE_CONFIG_PATH }}/resources/zosconnect/services
                    if [ $? -gt 0 ]; then 
                        echo "ERROR: Could not create directory" >&2;
                        exit "5"; 
                    fi
			    fi
			    
			    # Ensure server and group of associated users can add in AARs and SARs to the servers dropins directories
			    chmod 777 {{ ZCEE_CONFIG_PATH }}/resources/zosconnect/apis
                if [ $? -gt 0 ]; then 
                    echo "ERROR: Could not chmod directory" >&2;
                    exit "6"; 
                fi
			    chmod 777 {{ ZCEE_CONFIG_PATH }}/resources/zosconnect/services
                if [ $? -gt 0 ]; then 
                    echo "ERROR: Could not chmod directory" >&2;
                    exit "7"; 
                fi
                
                   			     
                # Create a properties file to populate instance variables with useful user information
                host=$(hostname)
                if [ $? -gt 0 ]; then
                    echo "ERROR: Could not query hostname" >&2;
                    exit "1"; 
                fi
                echo "ZCON_HOSTNAME $host" >> {{ZCON_ZFS_MOUNTPOINT}}/{{softwareServiceInstanceName}}/.tmp_server/server_dir
                if [ $? -gt 0 ]; then 
                    echo "ERROR: Could not create properties file" >&2;
                    exit "2"; 
                fi 

                # Create a properties file to populate instance variables with useful user information
                # This is read by the output element in the workflow step.
                echo "ZCON_SERVER_DIRECTORY {{ ZCEE_CONFIG_PATH }}" >> {{ZCON_ZFS_MOUNTPOINT}}/{{softwareServiceInstanceName}}/.tmp_server/server_dir
                echo "ZCON_RECOMMENDATION Export the environment variable WLP_USER_DIR={{ZCON_ZFS_MOUNTPOINT}}/{{softwareServiceInstanceName}} before you issue zosconnect commands against the server" >> {{ZCON_ZFS_MOUNTPOINT}}/{{softwareServiceInstanceName}}/.tmp_server/server_dir
				chmod 755 {{ZCON_ZFS_MOUNTPOINT}}/{{softwareServiceInstanceName}}/.tmp_server/server_dir
                if [ $? -gt 0 ]; then 
                    echo "ERROR: Could not chmod directory" >&2;
                    exit "8"; 
                fi
